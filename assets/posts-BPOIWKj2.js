import{D as P,r as l,j as s,a as w,q as b}from"./index-SNKWFbRR.js";import{u as C,J as f,A as x,C as j}from"./jobCard-BoNHhvSW.js";const F=({type:r})=>{async function t({pageParam:n=1}){return(await P.get(`/api/feed/${r}/${n}`)).data.posts}return C({staleTime:300*1e3,queryKey:["feed",r],queryFn:t,initialPageParam:1,refetchOnWindowFocus:!1,getNextPageParam:(n,c)=>n.length<9?void 0:c.length+1})},I=({vr:r,type:t="news"})=>{const{data:n,fetchNextPage:c,hasNextPage:u,isFetchingNextPage:i,isLoading:h}=F({type:t}),d=l.useRef(null),o=l.useRef(i);l.useEffect(()=>{o.current=i},[i]);const p=l.useCallback(e=>{e&&(!u||i||(d.current&&d.current.disconnect(),d.current=new IntersectionObserver(a=>{a[0].isIntersecting&&!o.current&&c()},{threshold:.1}),e&&d.current.observe(e)))},[c,u]),m=l.useMemo(()=>n?.pages.flat()??[],[n]),N=e=>{switch(e.type){case"news":return s.jsx(j,{className:"py-1",post:e,vr:r},e.id);case"shop":return s.jsx(x,{className:"py-1",ad:e,vr:r},e.id);case"job":return s.jsx(f,{className:"py-1",job:e,vr:r},e.id);default:return null}},y=e=>{switch(t){case"news":return e.map(a=>s.jsx(j,{className:"py-1",post:a,vr:r},a.id));case"shopping":return e.map(a=>s.jsx(x,{className:"py-1",ad:a,vr:r},a.id));case"job":return e.map(a=>s.jsx(f,{className:"py-1",job:a,vr:r},a.id));default:return null}};return s.jsx("div",{className:"py-2.5",children:s.jsxs("div",{className:w("grid gap-6 md:gap-7"),children:[h&&s.jsx("div",{className:"flex items-center justify-center py-20",children:s.jsx(g,{})}),t==="all"?m.map(N):y(m),u&&s.jsx("div",{ref:p,className:"flex items-center justify-center py-20",children:i&&s.jsx(g,{})})]})})},g=()=>s.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[s.jsx(b,{className:"h-5 w-5 animate-spin"}),s.jsx("span",{className:"text-sm",children:"Loading more posts..."})]});export{I as P};
