import{m as P,r as o,j as e,a as w}from"./index-iJxv89Ze.js";import{C as f}from"./Card3-BlrK0g6v.js";import{u as b,J as x,A as g}from"./jobCard-BNCglg_Y.js";import{L as p}from"./loader-circle-DbBxqBaY.js";const C=({type:r})=>{async function n({pageParam:c=1}){return(await P.get(`/api/feed/${r}/${c}`)).data.posts}return b({staleTime:300*1e3,queryKey:["feed",r],queryFn:n,initialPageParam:1,refetchOnWindowFocus:!1,getNextPageParam:(c,i)=>c.length<9?void 0:i.length+1})},I=({vr:r,type:n="news"})=>{const{data:c,fetchNextPage:i,hasNextPage:d,isFetchingNextPage:t,isLoading:h}=C({type:n}),l=o.useRef(null),m=o.useRef(t);o.useEffect(()=>{m.current=t},[t]),console.log("isFetchingNextPage global : "+t);const j=o.useCallback(s=>{s&&(!d||t||(l.current&&l.current.disconnect(),l.current=new IntersectionObserver(a=>{a[0].isIntersecting&&!m.current&&i()},{threshold:.1}),s&&l.current.observe(s)))},[i,d]),u=c?.pages.flat()??[],N=s=>{switch(s.type){case"news":return e.jsx(f,{className:"py-1",post:s,vr:r},s.id);case"shop":return e.jsx(g,{className:"py-1",ad:s,vr:r},s.id);case"job":return e.jsx(x,{className:"py-1",job:s,vr:r},s.id);default:return null}},y=s=>{switch(n){case"news":return s.map(a=>e.jsx(f,{className:"py-1",post:a,vr:r},a.id));case"shopping":return s.map(a=>e.jsx(g,{className:"py-1",ad:a,vr:r},a.id));case"job":return s.map(a=>e.jsx(x,{className:"py-1",job:a,vr:r},a.id));default:return null}};return e.jsx("div",{className:"py-2.5",children:e.jsxs("div",{className:w("grid gap-6 md:gap-7"),children:[h&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(p,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading more posts..."})]})}),n==="all"?u.map(N):y(u),d&&e.jsx("div",{ref:j,className:"flex items-center justify-center py-20",children:t&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(p,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading more posts..."})]})})]})})};export{I as P};
