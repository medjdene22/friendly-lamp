import{m as P,r as l,j as s,a as w}from"./index-ELto49OG.js";import{u as b,J as f,A as x,C as j}from"./jobCard-D7oVXYpO.js";import{L as C}from"./loader-circle-Ag9EYWyz.js";const F=({type:r})=>{async function n({pageParam:t=1}){return(await P.get(`/api/feed/${r}/${t}`)).data.posts}return b({staleTime:300*1e3,queryKey:["feed",r],queryFn:n,initialPageParam:1,refetchOnWindowFocus:!1,getNextPageParam:(t,c)=>t.length<9?void 0:c.length+1})},I=({vr:r,type:n="news"})=>{const{data:t,fetchNextPage:c,hasNextPage:u,isFetchingNextPage:i,isLoading:p}=F({type:n}),d=l.useRef(null),o=l.useRef(i);l.useEffect(()=>{o.current=i},[i]);const h=l.useCallback(e=>{e&&(!u||i||(d.current&&d.current.disconnect(),d.current=new IntersectionObserver(a=>{a[0].isIntersecting&&!o.current&&c()},{threshold:.1}),e&&d.current.observe(e)))},[c,u]),m=l.useMemo(()=>t?.pages.flat()??[],[t]),N=e=>{switch(e.type){case"news":return s.jsx(j,{className:"py-1",post:e,vr:r},e.id);case"shop":return s.jsx(x,{className:"py-1",ad:e,vr:r},e.id);case"job":return s.jsx(f,{className:"py-1",job:e,vr:r},e.id);default:return null}},y=e=>{switch(n){case"news":return e.map(a=>s.jsx(j,{className:"py-1",post:a,vr:r},a.id));case"shopping":return e.map(a=>s.jsx(x,{className:"py-1",ad:a,vr:r},a.id));case"job":return e.map(a=>s.jsx(f,{className:"py-1",job:a,vr:r},a.id));default:return null}};return s.jsx("div",{className:"py-2.5",children:s.jsxs("div",{className:w("grid gap-6 md:gap-7"),children:[p&&s.jsx("div",{className:"flex items-center justify-center py-20",children:s.jsx(g,{})}),n==="all"?m.map(N):y(m),u&&s.jsx("div",{ref:h,className:"flex items-center justify-center py-20",children:i&&s.jsx(g,{})})]})})},g=()=>s.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[s.jsx(C,{className:"h-5 w-5 animate-spin"}),s.jsx("span",{className:"text-sm",children:"Loading more posts..."})]});export{I as P};
