import{n as y,o as h,r as d,j as e,a as j}from"./index-BdqRUGKt.js";import{u as N,J as w,A as v,C as b}from"./jobCard-DkSNYHFx.js";import{L as f}from"./loader-circle-CQuOfnsK.js";const L=({searchId:r})=>y({staleTime:3e5,queryKey:["search",r],queryFn:async()=>{try{return(await h.get(`/api/search/title/${r}`)).data}catch(t){throw new Error(t.response?.data?.message||"An error occurred while loading searche title")}}}),P=({searchId:r})=>{async function n({pageParam:t=1}){return(await h.get(`/api/search/posts/${r}/${t}`)).data.posts}return N({staleTime:300*1e3,queryKey:["feed",r],queryFn:n,initialPageParam:1,refetchOnWindowFocus:!1,getNextPageParam:(t,c)=>t.length<9?void 0:c.length+1})},R=({vr:r,id:n,type:t="news"})=>{const{data:c,fetchNextPage:l,hasNextPage:i,isFetchingNextPage:a,isLoading:x}=P({searchId:n}),o=d.useRef(null),u=d.useRef(a);d.useEffect(()=>{u.current=a},[a]);const p=d.useCallback(s=>{s&&(!i||a||(o.current&&o.current.disconnect(),o.current=new IntersectionObserver(g=>{g[0].isIntersecting&&!u.current&&l()},{threshold:.1}),s&&o.current.observe(s)))},[l,i,a]),m=c?.pages.flat()??[];return e.jsx("div",{className:"py-2.5",children:e.jsxs("div",{className:j("grid gap-6 md:gap-7"),children:[x&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(f,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading more posts..."})]})}),m.map(s=>{switch(t){case"news":return e.jsx(b,{className:"py-1",post:s,vr:r},s.id);case"ads":return e.jsx(v,{className:"py-1",vr:r,ad:s},s.id);case"job":return e.jsx(w,{vr:r,className:"py-1",job:s},s.id)}}),i&&e.jsx("div",{ref:p,className:"flex items-center justify-center py-20",children:a&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(f,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading more posts..."})]})}),!i&&m.length>0&&e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"You've reached the end. Check back later for more stories!"})]})})};export{R as S,L as u};
