import{l as y,m as h,r as l,j as e,a as j}from"./index-BqDI3d4f.js";import{C as N}from"./Card3-C7AewtmT.js";import{u as w,J as v,A as b}from"./jobCard-DvNs8o9s.js";import{L as f}from"./loader-circle-ChAXpzSL.js";const R=({searchId:r})=>y({staleTime:3e5,queryKey:["search",r],queryFn:async()=>{try{return(await h.get(`/api/search/title/${r}`)).data}catch(t){throw new Error(t.response?.data?.message||"An error occurred while loading searche title")}}}),P=({searchId:r})=>{async function n({pageParam:t=1}){return(await h.get(`/api/search/posts/${r}/${t}`)).data.posts}return w({staleTime:300*1e3,queryKey:["feed",r],queryFn:n,initialPageParam:1,refetchOnWindowFocus:!1,getNextPageParam:(t,c)=>t.length<9?void 0:c.length+1})},E=({vr:r,id:n,type:t="news"})=>{const{data:c,fetchNextPage:d,hasNextPage:i,isFetchingNextPage:a,isLoading:x}=P({searchId:n}),o=l.useRef(null),u=l.useRef(a);l.useEffect(()=>{u.current=a},[a]);const p=l.useCallback(s=>{s&&(!i||a||(o.current&&o.current.disconnect(),o.current=new IntersectionObserver(g=>{g[0].isIntersecting&&!u.current&&d()},{threshold:.1}),s&&o.current.observe(s)))},[d,i,a]),m=c?.pages.flat()??[];return e.jsx("div",{className:"py-2.5",children:e.jsxs("div",{className:j("grid gap-6 md:gap-7"),children:[x&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(f,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading more posts..."})]})}),m.map(s=>{switch(t){case"news":return e.jsx(N,{className:"py-1",post:s,vr:r},s.id);case"ads":return e.jsx(b,{className:"py-1",vr:r,ad:s},s.id);case"job":return e.jsx(v,{vr:r,className:"py-1",job:s},s.id)}}),i&&e.jsx("div",{ref:p,className:"flex items-center justify-center py-20",children:a&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(f,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading more posts..."})]})}),!i&&m.length>0&&e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"You've reached the end. Check back later for more stories!"})]})})};export{E as S,R as u};
